<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HADO - Casiers zone d√©part</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="stylesheet" href="css/print.css">
</head>
<body>
    <div id="loginPage" class="login-container active">
        <div class="login-box">
            <h1>HADO - Casiers zone d√©part</h1>
            <!-- <p style="color: #666; margin-bottom: 30px;">S√©lectionnez un mode d'acc√®s</p> -->
            <form id="loginForm">
                <div class="form-group" id="userNameGroup" style="display: none;">
                    <input type="text" id="userName" placeholder="Votre nom ou initiales" autocomplete="off">
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" placeholder="Mot de passe (optionnel)" autocomplete="off">
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">Se connecter</button>
                <button type="button" class="btn-secondary" style="width: 100%; margin-top: 10px;" onclick="loginAsGuest()">Visualiser les casiers</button>
            </form>
        </div>
    </div>

    <div class="container" id="appContainer" style="display: none;">
        <header>
            <div class="header-info">
                <div>
                    <h1>HADO - Casiers zone d√©part</h1>
                    <div id="authStatus" style="font-size: 12px; color: #666; margin-top: 5px;"></div>
                </div>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <div id="serverStatus" class="server-status offline">‚ö™ V√©rification...</div>
                    <button class="btn-secondary btn-small" onclick="logout()">D√©connexion</button>
                </div>
            </div>
            <div class="search-bar">
                <input type="text" id="globalSearch" placeholder="Rechercher par nom, pr√©nom ou IPP...">
                <button class="btn-secondary admin-only" onclick="importClients()" title="Importer les admissions depuis un export MH">‚¨ÜÔ∏è Import pr√©sents</button>
                <button class="btn-secondary admin-only" onclick="importCSV()" title="Importer des donn√©es casiers depuis un CSV">‚¨ÜÔ∏è Import casiers</button>
                <button class="btn-secondary admin-only" onclick="exportData('json')" title="Exporter les casiers au format JSON">‚¨á JSON</button>
                <button class="btn-secondary admin-only" onclick="exportData('csv')" title="Exporter les casiers au format CSV">‚¨á CSV</button>
                <button class="btn-secondary admin-only" onclick="createBackup()" title="Cr√©er un backup manuel de la base Sqlite">üíæ Backup</button>
            </div>
        </header>

        <!-- ONGLETS (seront g√©n√©r√©s dynamiquement) -->
        <div class="tabs"></div>

        <!-- CONTENU (sera g√©n√©r√© dynamiquement) -->
        <div id="dynamicContent"></div>

        <!-- FOOTER -->
        <footer class="app-footer">
            <p>¬© 2025, C.Vinson & Sonnet 4.5</p>
        </footer>        
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modalTitle">Attribuer un casier</div>
            <div id="statusMessage"></div>
            <form id="lockerForm">
                <div class="form-group">
                    <label for="zone">Zone</label>
                    <select id="zone" required>
                        <option value="NORD">NORD</option>
                        <option value="SUD">SUD</option>
                        <option value="PCA">PCA</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="lockerNumber">N¬∞ Casier</label>
                    <select id="lockerNumber" required></select>
                </div>
                <div class="form-group">
                    <label for="lastName">Nom</label>
                    <input type="text" id="lastName" required>
                </div>
                <div class="form-group">
                    <label for="firstName">Pr√©nom</label>
                    <input type="text" id="firstName" required>
                </div>
                <div class="form-group">
                    <label for="code">N¬∞IPP</label>
                    <div style="display: flex; gap: 5px; align-items: center;">
                        <input type="text" id="code" required style="flex: 1; margin: 0;">
                        <button type="button" class="btn-secondary" onclick="searchClient()" style="white-space: nowrap; flex-shrink: 0; padding: 10px 12px;">üîç Rechercher</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="birthDate">DDN</label>
                    <input type="date" id="birthDate" required>
                </div>
                <div class="form-group">
                    <label for="comment">Commentaire (optionnel)</label>
                    <textarea id="comment" rows="2" placeholder="Notes, remarques..."></textarea>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="recoverable" style="margin-right: 8px; width: auto;">
                        <span>R√©cup√©rable (en cas de p√©nurie)</span>
                    </label>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Annuler</button>
                    <button type="submit" class="btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>